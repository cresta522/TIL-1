## awk(オーク)コマンド

awkはテキストの検索や抽出、加工などの編集操作を行うためのコマンド

sedよりもずっと高機能で、テキスト処理に特化したプログラミング言語というような位置付けみたい。

```
awk <script> <file>
```
という書式で実行する。

スクリプトは<パターン>と<アクション>で構成される。

```
パターン{アクション}
```

まとめるとこういうこと

```
awk 'パターン{アクション}' ファイル
```

パターンにはアクションを実行するかどうかの条件を記載。パターンを指定しないこともできるが、この場合は全てのレコードに対してアクションが実行されることになる。

（awkでは処理対象のテキストを1行読み込むごとにパターンの判定があり、その1行の入力テキストのことをレコードと呼ぶ)

スクリプトの部分はやっぱり、シェルに勘違いさせないようにクオートで囲む。

awkでは**特定のフィールドを抽出して表示する列選択の処理**が最も使われる。

例
```
ls -l /usr/bin | awk '{print $5,$9}'
```

 ここでいう`$5`みたいのはフィールド変数というもの。
 
 `-rwsr-xr-x.($1) 1($2) root($3) root($4)  57536($5) Dec($6) 13($7) 2019($8) crontab($9)`
 
 $0 → 全体
 
 組み込み変数NFというものがある。$NFをprintすると、レコードの最後のフィールドが表示される。
 
 最後から2番目のフィールドを表示したいときは`$(NF-2)`とすれば良いので、フィールド変数が一定でない時やフィールドが多いときに便利。
 
 ### パターンを指定
 
 ```
ls -l /usr/bin | awk '$9 ~ /^cp/ {print $5,$9}'
```

のようにすると、パターンを指定できる。

$9つまり第9フィールドが/^cp/つまり、cpから始まるパターンを指定している。

`~`は正規表現とマッチするかどうかを調べる記号。

 ```
ls -l /usr/bin | awk '/^l/ {print $5,$9}'
```

のように、正規表現を使用する場合は、比較対象のフィールドを省略することができる。この場合はレコード全体が対象となる。上の例では行頭に`l`がついているファイル、つまりシンボリックリンクだけを表示する指定の仕方。

### アクションの省略

awkではアクションの部分を省略することで、レコードを表示することになる。

` awk '$9 ~ /^cp/'`（アクションを省略)

` awk '$9 ~ /^cp/ {print}'`　(アクションの引数を省略)

` awk '$9 ~ /^cp/ {print $0}'` ($0 第0フィールドを指定、つまりレコードを表示)

上の3つの記述の結果はどれも同じになる。

`-f`オプションを使用すると、保存しておいたスクリプトのファイルを読み込むことができる。
`awk -F, '{sum += $NF} END{print "Average : ",sum/NR}' file.csv`

で点数の平均を出すアクションを書いたとすると、これを他の場面でも再利用できるように` {sum += $NF} END{print "Average : ",sum/NR} `の部分をaverage.awkというファイル名で保存しておく

`awk -F, -f average.awk file.csv`と実行すると、先ほど保存したファイルを利用することができる。

 
 
 



