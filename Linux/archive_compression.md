## ファイルのアーカイブと圧縮

ファイルをまとめるアーカイブ処理と圧縮処理、WindowsなどのPCではひとまとめでやってしまうが、Linuxだとそれぞれコマンドがあり、実行できる。

### ファイルのアーカイブ処理

複数のファイルやディレクトリをまとめたファイルのことをアーカイブと呼ぶ。`tar`コマンドで行う

### tarコマンド

ファイルをアーカイブするためのコマンド。古くから使われているコマンドで、一般的には`-`をつけずに`tar cf dir1`のようにオプションをつける。

#### 書式


``` 
アーカイブファイルを作成

tar cf <アーカイブファイル> <アーカイブ元ファイルパス>
```

```
アーカイブファイルの内容確認

tar tf <アーカイブファイル> <アーカイブ元ファイルパス>
```

このとき、`tvf`とvオプションもつけてあげると、ファイルのパーミッションなどのデータも表示できる。（よく使用される。）

vオプションはcオプションなどとも組み合わせて使うことができるが、エラーメッセージなどを見逃してしまうケースを生じることも少なくないため、基本的にはtオプションとのみ合わせて使う。

```
アーカイブファイルの展開

tar xf <アーカイブファイル>
```

ファイルのパーミッションによってはうまくアーカイブできない場合もあることを覚えておく。（rootユーザでないとうまく展開できない場合などがあるみたい）

そのため、ディレクトリツリーの完全なバックアップを取りたい場合にはroot権限でtarコマンドを実行する必要がある。


### gzipコマンド

ファイルの圧縮・展開を行うコマンド

#### 書式

```
ファイルを圧縮

gzip <圧縮元ファイル>
```

```
ファイルの展開

gzip -d <圧縮元ファイル>.gz
```
圧縮ファイル(.gz)は削除される

gzipコマンドでは一つのファイルを圧縮・展開する機能しかないので、tarコマンドと組み合わせることで、複数のファイルをひとまとめにして圧縮できる

```
アーカイブ・圧縮
tar czf dir1.tar.gz dir1

展開
tar xzf dir.tar.gz
```
tarコマンドのオプションにzオプションを渡してあげる。


パイプラインを使う方法もある。

```
tar cf - dir1 | gzip -c > dir1.tar.gz
```
tarコマンドで`cf -`のようにファイル名として`-`を指定すると、アーカイブファイルが標準出力に出力される。gzipコマンドでは標準入力としてtarファイルを受け取り、dir1.tar.gzというファイルへ出力リダイレクトする。

```
tar.gzファイルをgzipで展開
gzip -d -c dir1.tar.gz | tar xf -
```
gzipコマンドで-d(展開)した出力を-cオプションとパイプラインでtarコマンドに渡す。tarコマンドのxオプションでファイル名を`-`にしてあげると、標準入力としてファイルを受け取ることができる。

昔はこのようにやっていました、という紹介だがこの手法は現在でも使われているので、こういう方法もあるということは覚えておく。


```
リモートホストserverBのディレクトリdir1をtar+gzファイルとして転送
ssh yusei@serverB 'tar czf -dir1' | tar xzf -
```
リモートホスト上のファイルを直接手元にコピーする手法


### bzip2コマンド

gzipと同じようにファイルを圧縮するコマンド。gzipよりも圧縮率が高いが、gzipより時間がかかる。

オプションに関してはgzipと同じように設計されている。

tarでbzip2形式を利用するにはjオプションを利用する

```
tar cjf dir1.tar.bz2 dir1
```

### zip

zipコマンドではアーカイブと圧縮をひとまとめにやってくれる。Win、Macではよく用いられるがLinuxではあまり。

他のOS間でデータのやりとりをする際に必要になったりする。

#### 書式


```
zipファイルを作成
zip -r <圧縮ファイル名> <圧縮対象パス>
```

`-r`オプションは指定したディレクトリの下にに含まれるファイルもまとめて圧縮するためのオプション。`r`オプションは単一のファイルにも使えるので、zipファイルを作成するときは常に-rオプションを利用した方がよい。









