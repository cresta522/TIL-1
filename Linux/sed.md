## sedコマンド　

sedコマンド　ストリームエディタ(Streom Editor)の略

メモ帳とかVimみたいな対話式のテキストエディタではなく、非対話式のテキストエディタ

対話式っていうのは今マークダウンを打っているこの画面みたいな文字を入力する画面があるようなエディタだが、非対話式はそれがなく、コマンドで渡した引数などによって指定した風に文字列を置換したりする形

sedコマンドでは正規表現をつかって、文字列のパターンを拾ってくることもでき、また「東京とかいてあるところを全部、大阪に置換する」みたいな操作もできるため、一括でいろんなところを編集するのは便利。

また、編集対象のファイルの内容を書き換えてしまうのではなく、置換した結果を標準出力に出力するという動作になるため、ファイルの破壊的な変更は行わないため、気軽に使用できる。

置換元のファイルについては引数で渡してもよいが、その指定がない場合は標準入力を置換元とするため、パイプで何かの操作の結果を繋ぐこともできる。

### sedコマンドの指定方式

```
sed [option] <script> <file>
```

スクリプトの部分は「アドレス」と「コマンド」を組み合わせた文字列。アドレスは省略可能

コマンドのうち、よく使うものとしては

- 行を削除する`d`
- 行を表示する`p`
- 行を置換する`s`

がある。

### 行の削除　-d

` sed 1d file.txt `とすると、file.txtの1行目を削除して出力される。

アドレスの部分は行番号で指定してあるけど、ここは`1,5`とすると、1行目から5行目という意味になる。

また、正規表現を使うこともでき、`/^B/d`とすれば行頭がBで始まる行という意味になる。

「2行目から最後の行まで」という風にするときは`$`を利用するが、シェルに勘違いさせないために、`2,$d'とシングルクオートで囲って指定してあげる。

### パターンスペースの自動出力

sedコマンドでは行を読み込むとまず、パターンスペースという場所に一旦コピーして、そのパターンスペースに編集コマンドを実行してから、最後にパターンスペースの内容を出力する。

スクリプトの部分に`1p`として１行目を表示したいとき、1行目はコマンドの指定通り、表示されるが、その後パターンスペースが自動出力されてしまうため、思った通りの動作にならない。

パターンスペースを自動出力させたくないときには`-n`オプションをつけてあげる。　→ 「置換が発生した場合に、その部分だけ出力したい」というときにも`-n`は使える。

### 行を置換する -s

`-s`は行を置換するためのコマンド。sedを利用するケースのほとんどは置換を目的としているので、よく使う。

書式は以下のようにする

```
's/置換前文字列/置換後文字列/フラグ'
```

フラグは省略可能。スクリプトで正規表現を使うケースが多いため、基本的にシングルクオートで囲んでおいた方がよい。

置換後文字列の部分を空行にすると、置換前として指定した文字列を削除するという意味になる。

何もフラグをつけずに実行する場合、sコマンドでの置換では、*行頭から探して最初に見つかった文字列だけを置換して、そこで処理を終了してしまう。*

指定した文字列は全て置換したい場合、フラグの部分に`g`フラグをつけてあげると、見つかった文字列を全て置換するという動作になる。

また、パターンスペースを出力せずに、置換した部分だけを出力するようにしていするためには`-n`オプションと`p`フラグをつける必要がある。

```
sed -n 's/B.*r/Oh-Long-tea/gp' file.txt
```

`s/A/B/g`のように`/`を区切り文字としているが、これは別に`/`でなくてもよい。これ以外では慣習的に`!`や`%`が用いられることが多いみたい。






